# 
# SLURM configuration file for Sherlock
#

# =============================================================================
# Global options

#
# Daemons
#
SlurmUser=daemon
StateSaveLocation=/var/spool/slurm.state
ReturnToService=2
SlurmdTimeout=900
MessageTimeout=30
MsgAggregationParams=WindowMsgs=10
PluginDir=/usr/lib64/slurm

#
# Logging (use syslog)
#
#DebugFlags=Backfill,BackfillMap
SlurmctldDebug=info
SlurmdDebug=info

#
# Misc
#
# See http://bugs.schedmd.com/show_bug.cgi?id=732
#SallocDefaultCommand = "srun -n1 -N1 --mem-per-cpu=0 --pty --preserve-env $SHELL"
RebootProgram=/share/sw/admin/scripts/rocks/upgrade_and_redeploy_node.sh
MailProg=/usr/bin/smail

#
# MPI
#
MpiDefault=pmi2

#
# Resources and limits
#
MinJobAge=30
MaxJobCount=50000
GresTypes=gpu
PropagateResourceLimitsExcept=MEMLOCK,NOFILE,NPROC,AS,CPU
PrivateData=reservations,usage,users

#
# Prolog/Epilog
#
PrologSlurmctld=/etc/slurm/slurm.slurmctld_prolog.sh
Prolog=/etc/slurm/slurm.prolog.sh
PrologFlags=contain
TaskProlog=/etc/slurm/slurm.taskprolog.sh
Epilog=/etc/slurm/slurm.epilog.sh

#
# Tracking and plugins
#
ProctrackType=proctrack/cgroup
TaskPlugin=task/cgroup
TopologyPlugin=topology/tree

#
# Scheduling
#
SchedulerType=sched/backfill
#SchedulerParameters=default_queue_depth=25000,partition_job_depth=5000,bf_continue,bf_busy_nodes,bf_window=10080,bf_interval=60,bf_min_prio_reserve=3000,bf_min_age_reserve=3600,bf_max_job_test=3000,bf_max_job_array_resv=5,bf_max_job_part=100,bf_max_job_user=10,kill_invalid_depend,nohold_on_prolog_fail,pack_serial_at_end
#SchedulerParameters=default_queue_depth=1000,bf_continue,bf_busy_nodes,bf_window=10080,bf_interval=60,bf_min_prio_reserve=3000,bf_min_age_reserve=3600,bf_max_job_test=1000,bf_max_job_array_resv=5,bf_max_job_part=100,bf_max_job_user=10,kill_invalid_depend,nohold_on_prolog_fail,pack_serial_at_end
#SchedulerParameters=bf_continue,bf_busy_nodes,bf_window=10080,kill_invalid_depend,nohold_on_prolog_fail,pack_serial_at_end,max_rpc_cnt=64
#
# ST: this one works pretty well, with batch_sched_delay, sched_min_interval
#     (polling mode instead of on-event quick scheduling) and a high
#     default_queue_depth (number of jobs checked during quick scheduling)
SchedulerParameters=bf_continue,bf_busy_nodes,bf_interval=300,bf_max_job_test=15000,bf_max_job_part=3000,bf_max_job_user=100,bf_resolution=300,sched_interval=120,default_queue_depth=25000,kill_invalid_depend,nohold_on_prolog_fail,pack_serial_at_end,max_rpc_cnt=200,batch_sched_delay=10,sched_min_interval=5000000

FastSchedule=1

#
# Resource selection
#
SelectType=select/cons_res
SelectTypeParameters=CR_Core_Memory

#
# FairShare
#
PriorityType=priority/multifactor
PriorityDecayHalfLife=7-0
PriorityFavorSmall=NO
PriorityMaxAge=14-0
PriorityWeightAge=10000
PriorityWeightFairshare=100000
# job size factor is between 0 and 1 (for full cluster), so the weight must be huge
PriorityWeightJobSize=10000000
PriorityWeightPartition=100
PriorityWeightQOS=100
PriorityWeightTRES=CPU=1000,Mem=1000,GRES/gpu=5000
PriorityFlags=SMALL_RELATIVE_TO_TIME,FAIR_TREE
FairShareDampeningFactor=5

#
# Preemption
#
PreemptMode=requeue
PreemptType=preempt/partition_prio

#
# Accounting
#
JobCompType=jobcomp/none
JobAcctGatherType=jobacct_gather/linux
# experimental cgroup accounting, not very accurate apparently
# https://groups.google.com/d/msg/slurm-devel/RdvQVn7So1w/YeB1Yq9bRjoJ
#JobAcctGatherType=jobacct_gather/cgroup
JobAcctGatherFrequency=30
JobAcctGatherParams=UsePss
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageHost=sherlock-slurm01
AccountingStorageBackupHost=sherlock-slurm02
AccountingStorageEnforce=QOS,limits,safe
AccountingStorageTRES=gres/gpu
EnforcePartLimits=Yes
AcctGatherNodeFreq=300
# The IPMI plugin is too unreliable and error prone. It also can't discriminate
# energy usage per job, so it's pretty useless for us.
#AcctGatherEnergyType=acct_gather_energy/ipmi

#
# Health check
# 
HealthCheckProgram=/usr/sbin/nhc
HealthCheckInterval=600
# Only run health checks when the node has idle CPUs
HealthCheckNodeState=IDLE,MIXED,CYCLE



###############################################################################
# Specifics
#

#
# Cluster
#
ClusterName=sherlock
ControlMachine=sherlock-slurm01
BackupController=sherlock-slurm02
DefaultStorageType=slurmdbd
#DefaultSTorageHost is possibly not neccessary
#DefaultStorageHost=sherlock-slurm01

#
# Nodes
#

#
# >> Features
#
# Only the first 5 features will be used by Graphite for monitoring,
# but each node needs to have at least those 5 features
#
# -- CPU features
#   * CPU_GEN: CPU generation (eg. CPU_SNB, CPU_HSW...)
#   * CPU_SKU: CPU model (eg. E5-2640v2)
#   * CPU_FRQ: CPU frequency (eg. 2.60GHz)
# -- Accelerator features (required even for non-GPU nodes)
#   * GPU_GEN: GPU generation (eg. GPU_KPL, GPU_MXW... or NOACCL)
#   * GPU_SKU: GPU model (eg. TITAN_BLACK, TITAN_X...  or NOACCL)
# or
#   * MIC_GEN: MIC generation (eg. MIC_KNC, MIC_KNL..  or NOACCL)
#   * MIC_SKU: MIC model (eg. 5110P...                 or NOACCL)
#
#
# >> Weights
#
# Nodes with lower weight will be selected first.
# Nodes with more memory or GRES are given a higher weight, so they're saved for jobs that really need it
# Nodes with more recent CPU generation will be selected first to give the best performance
#
#   Weight mask: 1 | #GRES | Memory | #Cores | CPUgen | 1 
#       prefix is to avoid ovctal conversion
#       suffix is to avoid having null weights
#
#   Values:
#       #GRES   none: 0   Memory   64 GB: 0   #Cores  16: 0  CPUgen HSW: 7 
#              2 GPU: 1            96 GB: 1           24: 1         IVY: 8
#              4 GPU: 2           128 GB: 2           28: 2         SNB: 9
#              8 GPU: 3           256 GB: 3           32: 3
#                                 512 GB: 4           48: 4
#                                1534 GB: 5
# 
#       #GRES   none: 0   Memory   64 GB: 0   #Cores  16: 0  CPUgen HSW: 7 
#              2 GPU: 1            96 GB: 1           20: 1         IVY: 8
#              4 GPU: 2           128 GB: 2           24: 2         SNB: 9
#              8 GPU: 3           256 GB: 3           28: 3
#                                 512 GB: 4           32: 4
#                                1534 GB: 5           48: 5
# 
# regular 16-core, 64GB, Haswell nodes will get the default weight of 00001
#
# NB: RealMemory needs to be smaller than the actual memory

# Defaults, 16-core
NodeName=DEFAULT Sockets=2 CoresPerSocket=8 State=UNKNOWN
CpuFreqDef=Performance

# Sandy-Bridge, 32c, 1.5TB
NodeName=sh-1-[13-14] \
    Sockets=4  CoresPerSocket=8 \
    RealMemory=1536000 \
    Weight=105491 \
    Feature="CPU_SNB,E5-4640,2.40GHz,NOACCL,NOACCL"

# Ivy-Bridge, 16c, 64GB
NodeName=sh-0-[1-26,32-34,36],sh-1-[1-12],sh-2-[2-36],sh-3-[1-36],sh-5-[1-36],sh-7-[22-24],sh-8-[2-11,27-29],sh-[10-12]-[1-36],sh-13-[1-22] \
    RealMemory=64000 \
    Weight=100081 \
    Feature="CPU_IVY,E5-2650v2,2.60GHz,NOACCL,NOACCL"
          
# Ivy-Bridge, 16c, 128GB
NodeName=sh-0-[27-31,35],sh-1-[15-34],sh-7-[2-21],sh-8-[12-14,17-26] \
    RealMemory=128000 \
    Weight=102081 \
    Feature="CPU_IVY,E5-2650v2,2.60GHz,NOACCL,NOACCL"
 
# Ivy-Bridge, 16c, 256GB
NodeName=sh-8-[1,15-16] \
    RealMemory=256000 \
    Weight=103081 \
    Feature="CPU_IVY,E5-2650v2,2.60GHz,NOACCL,NOACCL"

# Haswell, 16c, 64GB
NodeName=sh-2-1,sh-7-[27-36],sh-8-[30-33],sh-17-[1-8,23-25],sh-18-[13,15-28],sh-20-[1-35],sh-21-[1-36],sh-22-[1-36],sh-23-[1-36],sh-24-[1-36],sh-25-[1-22,27-36],sh-26-[1-31],sh-27-[1-20,23-24],sh-30-[1-36],sh-31-[31-40],sh-13-[31-35] \
    RealMemory=64000 \
    Weight=100071 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,NOACCL,NOACCL"

# Haswell, 16c, 128GB
NodeName=sh-8-37,sh-17-[9-11,16-19],sh-18-[29-32],sh-27-[22,25-27,33-34],sh-28-[11,13-15] \
    RealMemory=128000 \
    Weight=102071 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,NOACCL,NOACCL"

# Haswell, 16c, 256GB
NodeName=sh-7-25,sh-8-[34-36],sh-17-[20-22,32],sh-18-[33-37],sh-26-[32-36],sh-27-[28-32],sh-28-[12,16-17] \
    RealMemory=256000 \
    Weight=103071 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,NOACCL,NOACCL"

# Haswell, 20c, 256GB
NodeName=sh-28-18 \
    RealMemory=256000 \
    Weight=103171 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,NOACCL,NOACCL"

# Haswell, 48c, 1.5TB
NodeName=sh-17-12,sh-25-23 \
    Sockets=4  CoresPerSocket=12 \ 
    RealMemory=1550000 \
    Weight=105571 \
    Feature="CPU_HSW,E7-4830v3,2.10GHz,NOACCL,NOACCL"

# Haswell, 32c, 256GB
NodeName=sh-17-[26-31] \
    CoresPerSocket=16 \ 
    RealMemory=256000 \
    Weight=103471 \
    Feature="CPU_HSW,E5-2698v3,2.30GHz,NOACCL,NOACCL"

# Haswell, 24c, 96GB
NodeName=sh-18-[1-10] \
    CoresPerSocket=12 \
    RealMemory=96000 \
    Weight=101271 \
    Feature="CPU_HSW,E5-2680v3,2.50GHz,NOACCL,NOACCL" 

# Haswell, 28c, 128GB
NodeName=sh-18-11 \
    CoresPerSocket=14 \
    RealMemory=128000 \
    Weight=102371 \
    Feature="CPU_HSW,E5-2695v3,2.30GHz,NOACCL,NOACCL" 
    
# GPU nodes
NodeName=gpu-9-[1-2] \              
    RealMemory=256000 \
    Gres=gpu:tesla:8 \
    Weight=133081 \ 
    Feature="CPU_IVY,E5-2640v2,2.00GHz,GPU_KPL,K20X,k20x"

NodeName=gpu-9-[3-5] \ 
    RealMemory=256000 \
    Gres=gpu:gtx:8 \
    Weight=133081 \
    Feature="CPU_IVY,E5-2640v2,2.00GHz,GPU_KPL,TITAN_BLACK,titanblack"

NodeName=gpu-9-[6-9] \
    RealMemory=64000 \ 
    Gres=gpu:gtx:4 \  
    Weight=120081 \
    Feature="CPU_IVY,E5-2650v2,2.60GHz,GPU_KPL,TITAN_BLACK,titanblack"

NodeName=gpu-9-10 \
    RealMemory=64000 \
    Gres=gpu:gtx:4 \
    Weight=120081 \
    Feature="CPU_IVY,E5-2640v2,2.00GHz,GPU_KPL,TITAN_BLACK,titanblack"

NodeName=gpu-14-[1-9],gpu-13-[1-2] \
    RealMemory=64000 \
    Gres=gpu:gtx:8 \
    Weight=130081 \
    Feature="CPU_IVY,E5-2640v2,2.00GHz,GPU_KPL,TITAN_BLACK,titanblack"

NodeName=gpu-15-[1-8],gpu-16-[1-8] \
    RealMemory=128000  \
    Gres=gpu:gtx:8 \
    Weight=132081 \
    Feature="CPU_IVY,E5-2650v2,2.60GHz,GPU_MXW,TITAN_X,titanx"

NodeName=gpu-15-[9-10] \
    RealMemory=128000 \ 
    Gres=gpu:gtx:8 \
    Weight=132071 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,GPU_MXW,TITAN_X,titanx"

NodeName=gpu-19-[1-8] \
    RealMemory=128000 \
    Gres=gpu:gtx:8 \  
    Weight=132071 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,GPU_MXW,TITAN_X,titanx"

NodeName=gpu-28-[1-2] \
    RealMemory=512000 \
    Gres=gpu:gtx:8 \  
    Weight=134081 \
    Feature="CPU_IVY,E5-2650v2,2.60GHz,GPU_MXW,TITAN_X,titanx"

NodeName=gpu-29-[1-8] \
    RealMemory=128000 \
    Gres=gpu:gtx:8 \  
    Weight=132081 \
    Feature="CPU_IVY,E5-2650v2,2.60GHz,GPU_MXW,TITAN_X,titanx"

NodeName=gpu-27-21 \
    RealMemory=128000 \
    Gres=gpu:tesla:8 \
    Weight=132071 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,GPU_KPL,K80"

NodeName=gpu-17-35,gpu-27-35,gpu-28-[19-20] \
    RealMemory=256000 \
    Gres=gpu:tesla:8 \
    Weight=133071 \
    Feature="CPU_HSW,E5-2640v3,2.60GHz,GPU_KPL,K80"


#
# Partitions
#
PartitionName=DEFAULT AllocNodes=ALL State=UP DisableRootJobs=YES 

# Test partition for... testing purposes
PartitionName=test      AllowGroups=sys \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \  # 64GB 
	    nodes=sh-5-[33-34],gpu-9-10

# Notes:
# - MaxTime for the normal partition is 7 days, so that we can have a long QOS
#   (See EnforcePartLimits in slurm.conf). Normal QOS has a MaxWall of 2 days.
# - MaxMemPerCPU is used to avoid a 1-CPU job using all the memory on a node
#   while being allocated only 1 CPU. MaxMemPerCPU will automatically upgrade 
#   the number of cores allocated (ie. 16GB out of 64GB will allocate 4 cores) 
PartitionName=normal \
    Default=YES \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \  # 64GB 
    PriorityJobFactor=10 \
    AllowQos=normal,long,system \
	    nodes=sh-1-[1-12],sh-2-[1-36],sh-3-[1-36],sh-5-[1-32]

PartitionName=dev \      
    DefaultTime=1:0:0   MaxTime=0-2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \  # 64GB
    PriorityJobFactor=1000 \
    AllowQos=normal,dev,system \
    QOS=dev \
	    nodes=sh-5-[35-36]

PartitionName=bigmem \   
    DefaultTime=2:0:0 \
    DefMemPerCPU=48000  MaxMemPerCPU=49152 \ # 1.5TB
    PriorityJobFactor=100 \
    AllowQos=normal,bigmem,system \
    QOS=bigmem \
	    nodes=sh-1-[13-14]

PartitionName=gpu \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityJobFactor=100 \
    AllowQos=normal,gpu,system \
    QOS=gpu \
 	    nodes=gpu-9-[1-5],gpu-17-35

# Owners partitions
#
# Condo model: 
# 1. owners have exclusive access to their nodes, and can submit jobs to
# them using "-p <partition_name>", where <partition_name> is usually the
# PI's SUNet ID.
# 2. owners can also submit jobs to other owners' nodes, by using the "-p
# owners" parameter. Those jobs will be preempted by the rightful owner's
# own jobs, though. For instance, if ownerA submits jobs that run on
# ownerB's nodes, and ownerB then submits jobs to his/her own nodes,
# ownerA's jobs will be killed.
# 3. owners can still use the general pool of nodes to submit jobs.

# -- 2014 June --

PartitionName=cbohon \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=cbohon,sys \
    AllowQos=normal,long,system \
        nodes=sh-7-22

# Center for Computational Earth & Environmental Science:
# http://cees.stanford.edu/
PartitionName=cees \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=biondo,beroza,sys \
    AllowQos=normal,long,system \
        nodes=sh-0-[25-26,32-34,36]

PartitionName=dpwall \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=dpwall,sys \
    AllowQos=normal,long,system \
 	    nodes=sh-7-[2-20],sh-1-[25-34]

PartitionName=diffenbaugh \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=omramom,sys \
    AllowQos=normal,diffenbaugh,system \
    QOS=diffenbaugh \
        nodes=sh-0-[1-24]

PartitionName=russpold \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=russpold,sys \
    AllowQos=normal,russpold,russpold_interactive,system \
    QOS=russpold \
 	    nodes=sh-1-[15-24],sh-0-[27-31],sh-7-21

PartitionName=jhyoon1 \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=jhyoon1,sys \
    AllowQos=normal,long,system \
 	    nodes=sh-0-35

PartitionName=wolak \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=wolak,sys \
    AllowQos=normal,long,system \
        nodes=sh-7-[23-24]

# -- 2014 Oct --

PartitionName=rondror \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000 \ # mix 64/128/512GB: no MaxMemPerCPU 
    PriorityTier=1000 \
    AllowGroups=rondror,sys \
    AllowQos=normal,rondror,rondror_high,system \
    QOS=rondror \
        nodes=gpu-9-[6-9],gpu-15-[1-8],gpu-28-[1-2],gpu-29-[1-8]

# -- 2014 Dec --

PartitionName=iric \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000 \ # mix 64/128/1.5TB: no MaxMemPerCPU
    PriorityTier=1000 \
    AllowGroups=suncat,kipac,simes,pulse,sys \
    AllowQos=normal,iric,system \
    QOS=iric \
        nodes=gpu-14-[1-9],gpu-13-[1-2],sh-[10-12]-[1-36],sh-13-[1-22],gpu-19-[1-8],sh-20-[1-35],sh-21-[1-36],sh-22-[1-36],sh-23-[1-36],sh-24-[1-36],sh-25-[1-23,27-36],sh-26-[1-31],sh-30-[1-36],sh-31-[31-40],sh-13-[31-35]

# -- 2015 Jan --

PartitionName=rbaltman \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000 \ # mix 64/128/256GB: no MaxMemPerCPU 
    PriorityTier=1000 \
    AllowGroups=rbaltman,sys \
    AllowQos=normal,rbaltman,system \
    QOS=rbaltman \
        nodes=sh-8-[1-11],sh-17-[17-22],sh-27-[25-32]

PartitionName=whwong \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000 \ # mix 128/256GB: no MaxMemPerCPU 
    PriorityTier=1000 \
    AllowGroups=whwong,sys \
    AllowQos=normal,long,system \
        nodes=sh-8-[12-13,34-36],sh-26-[34-35]

PartitionName=stat \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000 \ # mix 128/256GB: no MaxMemPerCPU
    PriorityTier=1000 \
    AllowGroups=adembo,brajarat,candes,donoho,efron,gwalther,hastie,imj,jduchi,jtaylo,lait,lavori,lmackey,owen,romano,sabatti,siegmund,souravc,sph,tibs,whwong,sys \
    AllowQos=normal,long,system \
        nodes=sh-8-[14-16]

PartitionName=kornberg \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000 \ # mix 128/256GB: no MaxMemPerCPU
    PriorityTier=1000 \
    AllowGroups=kornberg,sys \
    AllowQos=normal,kornberg,system \
    QOS=kornberg \
        nodes=sh-8-[17-26],sh-17-[26-31]

PartitionName=manishad \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000 \ # mix 64/128: no MaxMemPerCPU 
    PriorityTier=1000 \
    AllowGroups=manishad,sys \
    AllowQos=normal,long,system \
        nodes=sh-8-[27-28],sh-18-[31-32],sh-28-[14-15]

# -- 2015 Feb

PartitionName=horence \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000 \ # mix 64/256: no MaxMemPerCPU
    PriorityTier=1000 \
    AllowGroups=horence,sys \
    AllowQos=normal,long,system \
        nodes=sh-8-29,sh-28-12

# -- 2015 Mar --

PartitionName=mcovert \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=mcovert,sys \
    AllowQos=normal,long,system \
        nodes=sh-8-[30-33]

# -- 2015 Apr --

PartitionName=fkessler \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=fkessler,sys \
    AllowQos=normal,long,system \
        nodes=sh-7-25

# -- 2015 May --

# Civil & Environmental Engineering
# http://cee.stanford.edu
PartitionName=cee \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=ggd,bakerjw,linder,fischer,billingt,borja,ask,law,mlepech,mime,sys \
    AllowQos=normal,cee,system \
    QOS=cee \
        nodes=sh-7-[27-36],sh-27-[1-10]

PartitionName=abutte \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=abutte,sys \
    AllowQos=normal,long,system \
        nodes=sh-8-37

# -- 2015 Jun --
# add more nodes to rondror

PartitionName=pande \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=pande,sys \
    AllowQos=normal,long,system \
        nodes=gpu-15-[9-10]

PartitionName=djames \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=djames,sys \
    AllowQos=normal,long,system \
        nodes=gpu-16-[1-3]

# Mechanics and Computation
# http://mc.stanford.edu/Main_Page
PartitionName=mc \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=darve,lewa,caiwei,ekuhl,pinsky,sys \
    AllowQos=normal,long,system \
        nodes=gpu-16-[4-8]

# -- 2015 Jul --

PartitionName=haiwang \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=haiwang,sys \
    AllowQos=normal,haiwang,system \
    QOS=haiwang \
        nodes=sh-17-[1-8]

# -- 2015 Sep --

PartitionName=hns \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000  \ # mix 64/128GB/1.5TB: no MaxMemPerCPU
    PriorityTier=1000 \
    AllowGroups=adembo,alduy,amnorcia,arungc,awagner,bblock,boskin,candes,chetty,chidsey,cy10,dmcfarla,ddonald,donoho,doubleh,dpetrov,dreis,dsfisher,duffie,efron,fayer,fukamit,gbarsh,gdaily,gentzkow,goldhab,gratta,gross,gwalther,hadly,hastie,hbfraser,iang,imj,leinav,jduchi,jlmcc,jp1,jtaylo,juliapr,jzaki,kipac,kivelson,klenow,kmoler,knutson,kpeay,lait,lexing,lmackey,malgeehe,mcfrank,memorten,mfeldman,mgduggan,mkanan,mschnitz,mwdenny,nbloom,nburns,ngoodman,noahr,owen,pande,pdupas,pista,pkurlat,pritch,pwd,quake,reininge,romano,russpold,ruthm,sabatti,schneidr,sganguli,sshenker,siegmund,souravc,spalumbi,sph,stack,tbres,tem26,tibs,tulja,wandell,whwong,wmoerner,wolak,yanx,youngsl,zfrank,sys \
    AllowQos=normal,hns,system \
    QOS=hns \
        nodes=sh-17-12,sh-27-[11-20]

PartitionName=hns_gpu \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=adembo,alduy,amnorcia,arungc,awagner,bblock,boskin,candes,chetty,chidsey,cy10,dmcfarla,ddonald,donoho,doubleh,dpetrov,dreis,dsfisher,duffie,efron,fayer,fukamit,gbarsh,gdaily,gentzkow,goldhab,gratta,gross,gwalther,hadly,hastie,hbfraser,iang,imj,leinav,jduchi,jlmcc,jp1,jtaylo,juliapr,jzaki,kipac,kivelson,klenow,kmoler,knutson,kpeay,lait,lexing,lmackey,malgeehe,mcfrank,memorten,mfeldman,mgduggan,mkanan,mschnitz,mwdenny,nbloom,nburns,ngoodman,noahr,owen,pande,pdupas,pista,pkurlat,pritch,pwd,quake,reininge,romano,russpold,ruthm,sabatti,schneidr,sganguli,sshenker,siegmund,souravc,spalumbi,sph,stack,tbres,tem26,tibs,tulja,wandell,whwong,wmoerner,wolak,yanx,youngsl,zfrank,sys \
    AllowQos=normal,system \
    QOS=hns_gpu \
        nodes=gpu-27-21

# -- 2015 Oct --
# add more nodes to iric
# add more nodes to rbaltman
# add more nodes to kornberg

PartitionName=euan \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=euan,sys \
    AllowQos=normal,long,system \
    QOS=owner \
        nodes=sh-17-[9-11]

PartitionName=jduchi \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=jduchi,sys \
    AllowQos=normal,long,system \
        nodes=sh-17-16

# BioChem
# wjg, herschla, rhiju
PartitionName=biochem \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=wjg,herschla,rhiju,sys \
    AllowQos=normal,long,system \
        nodes=sh-17-[23-25]

PartitionName=amarsden \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 96GB / 24 cores
    PriorityTier=1000 \
    AllowGroups=amarsden,sys \
    AllowQos=normal,long,system \
        nodes=sh-18-[1-10]

# -- 2016 Jan --

PartitionName=chetty \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=chetty,sys \
    AllowQos=normal,long,system \
        nodes=sh-17-32

PartitionName=hbfraser \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000 \ # mix 64/128GB: no MaxMemPerCPU 
    PriorityTier=1000 \
    AllowGroups=hbfraser,sys \
    AllowQos=normal,hbfraser,system \
    QOS=hbfraser \
        nodes=sh-18-[11,13,15-26]

# -- 2016 Feb --
# add more nodes to iric
# add more nodes to manishad

PartitionName=jianq \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=jianq,sys \
    AllowQos=normal,long,system \
        nodes=sh-18-[27-28]

PartitionName=delp \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=delp,sys \
    AllowQos=normal,long,system \
        nodes=sh-18-29

PartitionName=msalit \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=msalit,sys \
    AllowQos=normal,long,system \
        nodes=sh-18-30

# -- 2016 Mar --
# add more nodes to whwong

PartitionName=brunger \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=brunger,sys \
    AllowQos=normal,brunger,system \
    QOS=brunger \
        nodes=sh-18-[33-37]

PartitionName=lmackey \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=lmackey,sys \
    AllowQos=normal,long,system \
        nodes=sh-26-[32-33]

# -- 2016 Apr --
# add more nodes to cee

PartitionName=spalumbi \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=spalumbi,sys \
    AllowQos=normal,long,system \
        nodes=sh-26-36

# -- 2016 Jun --
# add more nodes to rondror
# add more nodes to hns
# add more nodes to rbaltman

PartitionName=eriking \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=eriking,sys \
    AllowQos=normal,eriking,system \
    QOS=eriking \
        nodes=sh-27-22

PartitionName=dpetrov \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000   MaxMemPerCPU=4096 \ # 64GB
    PriorityTier=1000 \
    AllowGroups=dpetrov,sys \
    AllowQos=normal,long,system \
        nodes=sh-27-[23-24]

PartitionName=pelc \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=pelc,sys \
    AllowQos=normal,long,system \
        nodes=sh-27-[33-34]

# -- 2016 Jan --

# IBIIS
# rubin, snapel, plevriti, langlotz
PartitionName=ibiis \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=langlotz,plevriti,rubin,snapel,sys \
    AllowQos=normal,system \
    QOS=ibiis \
        nodes=gpu-27-35

PartitionName=agitler \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=agitler,sys \
    AllowQos=normal,long,system \
        nodes=sh-28-11

# -- 2016 Aug --
# add more nodes to horence

PartitionName=jonfan \
    DefaultTime=2:0:0 \
    DefMemPerCPU=8000   MaxMemPerCPU=8192 \ # 128GB
    PriorityTier=1000 \
    AllowGroups=jonfan,sys \
    AllowQos=normal,long,system \
        nodes=sh-28-13

# -- 2016 Sep --
# add more nodes to iric
# add more nodes to manishad

PartitionName=schneidr \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=schneidr,sys \
    AllowQos=normal,long,system \
        nodes=sh-28-16

PartitionName=shenoy \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=shenoy,sys \
    AllowQos=normal,long,system \
        nodes=sh-28-17

# -- 2016 Dec --

PartitionName=pritch \
    DefaultTime=2:0:0 \
    DefMemPerCPU=16000  MaxMemPerCPU=16384 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=pritch,sys \
    AllowQos=normal,long,system \
        nodes=gpu-28-[19-20]

PartitionName=yamins \
    DefaultTime=2:0:0 \
    DefMemPerCPU=12800  MaxMemPerCPU=13107 \ # 256GB
    PriorityTier=1000 \
    AllowGroups=yamins,sys \
    AllowQos=normal,long,system \
        nodes=sh-28-18


# catch-all partition for all owners nodes
PartitionName=owners \
    DefaultTime=2:0:0 \
    DefMemPerCPU=4000 \ # No MaxMemPerCPU for partitions with mixed memory amounts
    PriorityTier=1 \
    AllowGroups=itsrc,sys,ruthm,abutte,adembo,amarsden,ask,bakerjw,beroza,billingt,biondo,borja,brajarat,caiwei,candes,cbohon,darve,djames,donoho,dpwall,efron,ekuhl,euan,fischer,fkessler,ggd,gwalther,haiwang,hastie,herschla,horence,imj,itsrc,jduchi,jhyoon1,jtaylo,kornberg,lait,lavori,law,lewa,lexing,linder,lmackey,manishad,mcovert,mime,mlepech,suncat,omramom,owen,pande,pinsky,rbaltman,rhiju,romano,rondror,russpold,ruthm,sabatti,siegmund,souravc,sph,sys,kipac,tibs,pulse,simes,whwong,wjg,wolak,chetty,hbfraser,jianq,delp,msalit,brunger,spalumbi,eriking,dpetrov,pelc,langlotz,plevriti,rubin,snapel,agitler,jonfan,schneidr,shenoy,pritch,yamins,aetkin \
    AllowQos=normal,system \
        nodes=gpu-14-[1-9],gpu-9-[6-9],gpu-13-[1-2],sh-[0,8,10-12]-[1-36],sh-8-37,sh-7-[2-25,27-36],sh-13-[1-22],sh-1-[15-34],gpu-15-[1-10],gpu-16-[1-8],sh-17-[1-12,16-32],sh-18-[1-11,13,15-37],gpu-19-[1-8],sh-20-[1-35],sh-21-[1-36],sh-22-[1-36],sh-23-[1-36],sh-24-[1-36],sh-25-[1-23,27-36],sh-26-[1-36],sh-27-[1-20,22-34],gpu-27-21,gpu-28-[1-2],gpu-29-[1-8],gpu-27-[21,35],sh-28-[11-18],sh-30-[1-36],sh-31-[31-40],sh-13-[31-35],gpu-28-[19-20]
